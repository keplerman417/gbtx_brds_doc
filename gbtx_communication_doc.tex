\documentclass[11pt,letterpaper]{refart}

\usepackage{gitinfo2}
\usepackage{amsmath,mathtools}

\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{caption}

\usepackage{microtype}
\usepackage[T1]{fontenc}

\usepackage{graphicx}
\usepackage{framed}
\usepackage{tikz}
\usepackage{booktabs}

\usepackage{xcolor}
\usepackage{listings}
\lstset{
    basicstyle=\ttfamily\footnotesize,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    frame=single,
    columns=flexible
}

\usepackage{placeins}
% Figures can only float within its *subsection*
\makeatletter
\AtBeginDocument{%
    \expandafter\renewcommand\expandafter\subsection\expandafter
        {\expandafter\@fb@secFB\subsection}%
    \newcommand\@fb@secFB{\FloatBarrier
        \gdef\@fb@afterHHook{\@fb@topbarrier \gdef\@fb@afterHHook{}}}%
    \g@addto@macro\@afterheading{\@fb@afterHHook}%
        \gdef\@fb@afterHHook{}%
}%
\makeatother

\usepackage{chngcntr}
\counterwithin{figure}{subsection}

\def\itwoc{I{$\scriptstyle^2$}C\ }
\newcommand\symbolwithin[2]{%
    {\mathmakebox[\widthof{\ensuremath{{}#2{}}}][c]{{#1}}}}

\title{GBTx Communication Document}
\author{University of Maryland LHCb group}

\begin{document}
\maketitle
\hfill\small{\texttt{Rev:~\gitRel~(\gitAbbrevHash)}}
\tableofcontents
\listoffigures
\clearpage

\section{Hardware setup}
\subsection{GBTx daughter board}
\input{include/hardware/gbtx_db/overview.tex}
\input{include/hardware/gbtx_db/configure_gbtx_to_use_external_i2c.tex}
\input{include/hardware/gbtx_db/configure_slave_to_use_master_sca.tex}
\input{include/hardware/gbtx_db/configure_gbtx_to_use_gbt_ic.tex}
\input{include/hardware/gbtx_db/configure_gbtx_tx_rx_widebus_fec.tex}
\input{include/hardware/gbtx_db/reset_gbtx.tex}

\subsection{Data control board}
\input{include/hardware/dcb/overview.tex}
\input{include/hardware/dcb/prepare_ffc_cable.tex}
\input{include/hardware/dcb/connect_i2c_to_master_gbtx.tex}
\input{include/hardware/dcb/connect_i2c_to_data_gbtxs.tex}
\input{include/hardware/dcb/reset_master_gbtx.tex}
\input{include/hardware/dcb/tx_datavalid_pull_up.tex}


\section{Software setup}
\input{include/software/program_master_gbtx_with_i2c.tex}
\input{include/software/check_communication_between_gbtx_and_minidaq.tex}
\input{include/software/program_slave_gbtx_registers.tex}
\input{include/software/program_slave_gbtx_file.tex}
\input{include/software/reset_dcb_data_gbtxs.tex}


\newpage \appendix
\section*{Appendices}
\addcontentsline{toc}{section}{Appendices}
\renewcommand{\thesubsection}{\Alph{subsection}}
\input{include/appendices/fix_gbt_server_error.tex}
\input{include/appendices/bypass_components_in_gbt_data_path.tex}
\input{include/appendices/prbs_tests.tex}
\input{include/appendices/gbtx_operation_modes.tex}
\input{include/appendices/flip_tx_polarity.tex}

\end{document}
